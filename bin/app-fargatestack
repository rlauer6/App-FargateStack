#!/usr/bin/env bash
#-*- mode: sh; -*-
# Script to run a Modulino...repurposed for App::FargateStack

pgm=$(basename $0)

REALPATH=$(command -v realpath)
REALPATH=${REALPATH:-readlink -f}

path=$(basename $($REALPATH $0))

if [ "$pgm" = "app-fargatestack" ]; then 
    pgm="app-FargateStack"
elif [ "$pgm" = "app-fargatestack-checker" ]; then 
   pgm="app-FargateStack-checker"
fi

MODULINO_PATH=$(echo $pgm | perl -ne 'chomp; printf "%s.pm", join "/", map { ucfirst $_ } split /-/;')
MODULINO=$(echo $pgm | perl -ne 'chomp; print join "::", map { ucfirst $_ } split /-/;')

test -n "$PERL5LIB" && PERL5LIBDIR="-I $PERL5LIB"

MODULINO_RUN=$(perl -M$MODULINO -e 'print $INC{"'$MODULINO_PATH'"}';)

if test -z "$MODULINO_RUN"; then
    echo "$MODULINO is not installed"
    exit 1;
fi

if test -n "$CARP_ALWAYS"; then
    CARP_ALWAYS="-MCarp::Always"
fi

SCRIPT_NAME=$(basename "$0") perl $CARP_ALWAYS $PERL5LIBDIR $MODULINO_RUN "$@"
